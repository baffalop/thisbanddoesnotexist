<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>thisbanddoesnotexist</title>

    <link href="https://fonts.googleapis.com/css?family=Ubuntu:500" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript">

const scale = 1200 / 1600
const imageSize = 140 * scale
const timeStagger = 2000

let ctx, foreground, background

let positions = [
  new Pos(687, 370), // John
  new Pos(804, 380), // George
  new Pos(945, 345), // Paul
  new Pos(1120, 369), // Ringo
  new Pos(436, 396), // young Paul
  new Pos(237, 390), // young George
  new Pos(222, 90), // bouncerish
  new Pos(396, 244), // b&w woman
  new Pos(666, 180), // young guy
  new Pos(780, 72), // almost Nietzsche?
  new Pos(936, 104), // Sinatra
  new Pos(1112, 224), // old bearded
  new Pos(1330, 176), // butler
]

ready(init)

function ready(fn) {
  if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
    fn()
  } else {
    document.addEventListener('DOMContentLoaded', fn)
  }
}

function init() {
  positions = shuffleArray(positions)

  ctx = document.getElementById('canvas').getContext('2d')

  background = new Image(1600 * scale, 900 * scale)
  background.src = 'img/sgtpp-ppl-only.jpg'
  background.addEventListener('load', function () {
    ctx.drawImage(background, 0, 0, background.width, background.height)
  })

  foreground = new Image(1600 * scale, 900 * scale)
  foreground.src = 'img/sgtpp-pplonly-cutout.png'

  foreground.addEventListener('load', function () {
    ctx.drawImage(foreground, 0, 0, foreground.width, foreground.height)

    for (let i = 0; i < positions.length; i++) {
      window.setTimeout(spawnPerson(i), i * timeStagger)
    }
  })
}

function spawnPerson(i)
{
  return () => {
    const nonexistentPerson = new Image(imageSize, imageSize)
    nonexistentPerson.src = `https://thispersondoesnotexist.com/?${i}`

    nonexistentPerson.addEventListener('load', function () {
      console.log(`nonexistent person ${i} loaded`)
      drawPerson(nonexistentPerson)
    })
  }
}

function drawPerson(person)
{
  for (let pos of positions) {
    if (pos.isEmpty()) {
      pos.populate(person)
      return
    }
  }
}

function Pos(x, y)
{
  this.x = x * scale
  this.y = y * scale
  this.img = null
}

Pos.prototype.isEmpty = function ()
{
  return this.img === null
}

Pos.prototype.populate = function (image)
{
  this.img = image
  this.draw()
}

Pos.prototype.draw = function ()
{
  if (this.img === null) return

  const xPos = this.x - (this.img.width / 2)
  const yPos = this.y - (this.img.height / 2)

  ctx.drawImage(this.img, xPos, yPos, this.img.width, this.img.height)
  ctx.drawImage(foreground, 0, 0, foreground.width, foreground.height)
}

// based on Knuth Shuffle (https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array)
function shuffleArray(arr)
{
  let currentIndex = arr.length
  let randomIndex, temp

  // While there remain elements to shuffle...
  while (currentIndex !== 0) {
    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex)
    currentIndex--
    // Swap with current
    temp = arr[randomIndex]
    arr[randomIndex] = arr[currentIndex]
    arr[currentIndex] = temp
  }
  return arr
}

    </script>
</head>
<body>
<br />
<div align="center">
    <div class="border">
        <canvas id="canvas" width="1200" height="675"></canvas>
    </div>
    <p>
        powered by <a href="https://thispersondoesnotexist.com/">thispersondoesnotexist</a>
        (<a href="https://www.inverse.com/article/53280-this-person-does-not-exist-gans-website">about</a>) /
        <a href="https://github.com/baffalop/thisbanddoesnotexist">source</a>
    </p>
</div>
</body>
</html>
