<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>thisbanddoesnotexist</title>

    <script type="text/javascript" src="vendor/jquery-3.3.1.js"></script>
    <script type="text/javascript">

const persons = 4
const imageSize = 140
const timeStagger = 2000

let ctx = null
let foreground = null
let background = null

let positions = [
  new Pos(687, 370), // John
  new Pos(804, 380), // George
  new Pos(945, 345), // Paul
  new Pos(1114, 369), // Ringo
  new Pos(436, 396), // young Paul
  new Pos(237, 390), // young George
  new Pos(222, 90), // bouncerish
  new Pos(396, 244), // b&w woman
  new Pos(666, 180), // young guy
  new Pos(780, 72), // almost Nietzsche?
  new Pos(936, 104), // Sinatra
  new Pos(1112, 224), // old bearded
  new Pos(1330, 176), // butler
]

$(function () {
  positions = shuffleArray(positions)

  ctx = $('#canvas')[0].getContext('2d')

  background = new Image(1600, 900)
  background.src = 'img/sgtpp-ppl-only.jpg'
  background.addEventListener('load', function () {
    ctx.drawImage(background, 0, 0)
  })

  foreground = new Image(1600, 900)
  foreground.src = 'img/sgtpp-pplonly-cutout.png'

  foreground.addEventListener('load', function () {
    ctx.drawImage(foreground, 0, 0)

    for (let i = 0; i < persons; i++) {
      window.setTimeout(spawnPerson(i), i * timeStagger)
    }
  })
})

function spawnPerson(i)
{
  return () => {
    const nonexistentPerson = new Image(imageSize, imageSize)
    nonexistentPerson.src = `https://thispersondoesnotexist.com/?${i}`

    nonexistentPerson.addEventListener('load', function () {
      console.log(`nonexistent person ${i} loaded`)
      drawPerson(nonexistentPerson)
    })
  }
}

function drawPerson(person)
{
  for (let pos of positions) {
    if (pos.isEmpty()) {
      pos.populate(person)
      return
    }
  }
}

function Pos(x, y)
{
  this.x = x
  this.y = y
  this.img = null
}

Pos.prototype.isEmpty = function ()
{
  return this.img === null
}

Pos.prototype.populate = function (image)
{
  this.img = image
  this.draw()
}

Pos.prototype.draw = function ()
{
  if (this.img === null) return

  const xPos = this.x - (this.img.width / 2)
  const yPos = this.y - (this.img.height / 2)

  ctx.drawImage(this.img, xPos, yPos, this.img.width, this.img.height)
  ctx.drawImage(foreground, 0, 0)
}

// based on Knuth Shuffle (https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array)
function shuffleArray(arr)
{
  let currentIndex = arr.length
  let randomIndex, temp

  // While there remain elements to shuffle...
  while (currentIndex !== 0) {
    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex)
    currentIndex--
    // Swap with current
    temp = arr[randomIndex]
    arr[randomIndex] = arr[currentIndex]
    arr[currentIndex] = temp
  }
  return arr
}

    </script>
</head>
<body>
<canvas id="canvas" width="1600" height="900"></canvas>
</body>
</html>
