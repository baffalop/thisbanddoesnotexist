<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>thisbanddoesnotexist</title>

    <script type="text/javascript" src="vendor/jquery-3.3.1.js"></script>
    <script type="text/javascript">

const persons = 4
const imageSize = 140
const timeStagger = 2000

let ctx = null
let foreground = null

const positions = [
  new Pos('John', 687, 370),
  new Pos('George', 804, 398),
  new Pos('Paul', 945, 345),
  new Pos('Ringo', 1114, 369),
]

$(function () {
  ctx = $('#canvas')[0].getContext('2d')

  foreground = new Image(1600, 900)
  foreground.src = 'img/sgtpp-pplonly-cutout.png'

  foreground.addEventListener('load', function () {
    ctx.drawImage(foreground, 0, 0)

    for (let i = 0; i < persons; i++) {
      window.setTimeout(spawnPerson(i), i * timeStagger)
    }
  })
})

function spawnPerson(i)
{
  return () => {
    const nonexistentPerson = new Image(imageSize, imageSize)
    nonexistentPerson.src = `https://thispersondoesnotexist.com/?${i}`

    nonexistentPerson.addEventListener('load', function () {
      console.log(`nonexistent person ${i} loaded`)
      drawPerson(nonexistentPerson)
    })
  }
}

function drawPerson(person)
{
  for (let pos of positions) {
    console.log(`checking position ${pos.name}`)

    if (pos.isEmpty()) {
      console.log(`Found empty position in ${pos.name}`)
      pos.populate(person)
      return
    }
  }
}

function Pos(name, x, y)
{
  this.name = name
  this.x = x
  this.y = y
  this.img = null
}

Pos.prototype.isEmpty = function ()
{
  return this.img === null
}

Pos.prototype.populate = function (image)
{
  this.img = image
  this.draw()
}

Pos.prototype.draw = function ()
{
  if (this.img === null) return

  const xPos = this.x - (this.img.width / 2)
  const yPos = this.y - (this.img.height / 2)

  ctx.drawImage(this.img, xPos, yPos, this.img.width, this.img.height)
  ctx.drawImage(foreground, 0, 0)
}

    </script>
</head>
<body>
<canvas id="canvas" width="1600" height="900"></canvas>
</body>
</html>
